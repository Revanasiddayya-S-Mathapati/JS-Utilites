<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">


<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>

.topnav {
  background-color: #000000;
  overflow: hidden;
}

/* Style the links inside the navigation bar */
.topnav a {
  float: left;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

/* Change the color of links on hover */
.topnav a:hover {
  background-color: rgb(188, 188, 188);
  color: rgb(0, 0, 0);
}

/* Add a color to the active/current link */
.topnav a.active {
  background-color: #000000;
  color: white;
}

* {
  box-sizing: border-box;
}
body{
            margin: 50px;
        }
</style>
</head>
<body>
<div class="topnav">
    <a class="active" href="../AP5logChecker.html">AP5 Log Checker</a>
    <a href="./TimerUtil.html">Timer Util</a>
    <a href="./BitmapToBytehex.html">BitMap TO ByteHex</a>
</div>
<div id="page-wrapper">
   <h1>Presto Timer</h1>
<span style="font-size: large;">Calculation of NetworkTime64 of Presto are done as following. 
</span><br />
<span style="font-size: large;">NetworkTime64 = (number of milliseconds since Jan 1, 1970 00:00:00) * 2000
</span><br />
<span style="font-size: large;">Each Presto Tick is of 500 nano seconds duration</span><br />
</div>
<br>
<div>
    <h2>Current Presto Time</h2>
    <h3 id="prestoTime">
    </h3>
    <button onclick="stopFunction()">Stop time</button>
<button onclick="startPrestoTimer()">Start time</button>
</div>
<div>
    <h2>
        Date To Presto Time Convertor
    </h2>
</div>
<form action="" id="d2mForm">
    <div class="mtb">
    <span style="font-size: large;">A date string</span><br />
    <span style="font-size: large;"><span class="tip">examples: <br />Mon Oct 14 2013 15:02:10 GMT-0700 (Pacific Standard Time)<br />09/23/2000 <br />09/23/2000 9:45:00 </span>
    </span><br />
    <span style="font-size: large;">Date String: <input name="input" size="60" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter a date string here." type="text" />
    </span><br />
    <span style="font-size: large;"><input name="d2mBtn" onclick="stringToNum(this.form);" title="Click to Convert to Presto Time" type="button" value="Convert to Presto Time" />
    <input name="m2dBtn" onclick="numToString(this.form);" title="Click to Convert to Date" type="button" value="Convert to Date" />
    <BR> Presto Time: <input name="output" size="45" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Presto NetworkTime64 here." type="text" /></span><br/>
    </div>
    </form>

<div>
    <h2>Presto NetworkTime64 to Days:Hour:Minute:Seconds Duration</h2>
    <form action="" id="c2rForm">
        <input name="prestoTicks" size="45" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Presto NetworkTime64 here." type="text" />
        <input name="presto2regBtn" onclick="presto2RegTime(this.form);" title="Click to Convert to Regular Time" type="button" value="Convert to Regular Time" />
        
        <BR>Days:<input name="regDays" size="7" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Days" type="text" />
         Hours:<input name="regHours" size="2" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Hours" type="text" />
         Minutes:<input name="regMinutes" size="2" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Minutes" type="text" />
         Seconds:<input name="regSeconds" size="2" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; color: blue;" title="Enter Seconds" type="text" />
        <input name="reg2prestoTicks" onclick="regTime2PrestoTicks(this.form);" title="Click to Convert to Presto Time" type="button" value="Convert to Presto Ticks" />
        
        
        <br />
        <h3 id="regularTime" title="Hours:Minutes:Seconds">
        </h3>
        </form>
</div>
</body>
</html>

<script>
    
    var prestoVar;
    
    function startPrestoTimer()
    {
      prestoVar=setInterval(function(){prestoTimer()},1000);
    }
    
    function prestoTimer()
    {
      var d = new Date();
      var t = d.toLocaleTimeString();
      var n = Date.now();
      console.log(Date.now())
      var tagTimeD = n * 2000;
      var tagTimeI = new Number(tagTimeD);
      var tagTimeF = tagTimeI.toString(16);
      var tagTimeS = tagTimeF.toUpperCase();
      var tagTimeSF = tagTimeS.split(".")[0];
      tagTimeSF = tagTimeSF.padStart(16, '0');
      var frameCountI = Number(BigInt(tagTimeI) >> BigInt(21));
      var frameCountS = frameCountI.toString(16).toUpperCase().padStart(8, '0');
    
      document.getElementById("prestoTime").innerHTML= "Gregorian Time: " + d + 
        "<br> CurrentTimeMillis: " + n +
        "<br> Current Frame Count(Decimal): " + frameCountI +
        "<br> Current Frame Count(Hex): " + frameCountS +
        "<br> Presto NetworkTime64(Decimal): " + tagTimeI +
        "<br> Presto NetworkTime64(Hex): " + tagTimeSF.substring(0,8) + "-" + tagTimeSF.substring(8,16);
    }
    
    function stopFunction()
    {
      clearInterval(prestoVar);
    }

    function stringToNum(f){
 if(!f.input.value.length){
  alert("Please enter a date string first.");
  return;
 }
  var d = Date.parse(f.input.value)
  var tagTimeD = d * 2000;
  var tagTimeI = new Number(tagTimeD);
  var tagTimeT = tagTimeI.toFixed(0);
  var tagTimeF = tagTimeI.toString(16);
  var tagTimeS = tagTimeF.toUpperCase();
  var tagTimeSF = tagTimeS.split(".")[0];

  f.output.value = tagTimeSF;
}


function numToString(f){
  if(!f.output.value.length){
   alert("Please enter a Presto Time first.");
   return;
  }
  var n = Date.now();
  var prestoTime = parseInt(f.output.value, 16);
  var msTime = prestoTime/2000;
  var msTimeN = new Number(msTime);
  var msTimeF = msTimeN.toFixed(0);
  var d = new Date(parseInt(msTimeF, 10));
  f.input.value = d;
}

function presto2RegTime(f){
 if(!f.prestoTicks.value.length){
  alert("Please enter a Presto NetworkTime64");
  return;
 }
  var prestoTicks = parseInt(f.prestoTicks.value, 16);
  var regSeconds = prestoTicks/(2000*1000);
  var days = Math.floor(regSeconds / (3600*24));
  var hours = Math.floor((regSeconds -(days*24*3600)) / 3600);
  var minutes =  Math.floor((regSeconds -(days*24*3600) - (hours * 3600)) / 60);
  var seconds =  Math.floor(regSeconds -(days*24*3600) - (hours * 3600) - (minutes * 60));

  //document.getElementById("regularTime").innerHTML = "Days:" + days + " Hours: " + hours + " Minutes: " + minutes + " Seconds:" + seconds;
  f.regDays.value = days;
  f.regHours.value = hours;
  f.regMinutes.value = minutes;
  f.regSeconds.value = seconds;
}
  
  
function regTime2PrestoTicks(f){
  var days = parseInt(f.regDays.value, 10);
  var hours = parseInt(f.regHours.value, 10);
  var minutes = parseInt(f.regMinutes.value, 10);
  var seconds = parseInt(f.regSeconds.value, 10);

  var prestoTicks = (days * 24 * 60 * 60 * 1000 * 2000) + (hours * 60 * 60 * 1000 * 2000) + (minutes * 60 * 1000 * 2000) + (seconds * 1000 * 2000);
  f.prestoTicks.value = prestoTicks.toString(16);
}
</script>
