<meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
<meta content="utf-8" http-equiv="encoding" />

<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .topnav {
        background-color: #000000;
        overflow: hidden;
      }

      /* Style the links inside the navigation bar */
      .topnav a {
        float: left;
        color: #f2f2f2;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 17px;
      }

      /* Change the color of links on hover */
      .topnav a:hover {
        background-color: rgb(188, 188, 188);
        color: rgb(0, 0, 0);
      }

      /* Add a color to the active/current link */
      .topnav a.active {
        background-color: #000000;
        color: white;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 50px;
      }
      #btnBmapToBhex {
        margin-right: 20px;
      }
      #textareaetc {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
      }
      #widthInput {
        display: flex;
        flex-direction: column;
      }
      #imagedisplay {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        background-color: rgb(188, 188, 188);
      }
    </style>
  </head>
  <body>
    <div class="topnav">
      <a class="active" href="../AP5logChecker.html">AP5 Log Checker</a>
      <a href="./TimerUtil.html">Timer Util</a>
      <a href="./BitmapToBytehex.html"
        >BitMap To ByteHex <br />ByteHex To BitMap
      </a>
    </div>
    <div>
      <h1>Bitmap To ByteHex</h1>
      <p>Choose Bitmap</p>
      <input
        type="file"
        id="imageInput"
        onchange="displaySelectedImage(this)"
      />
      <br />
      <div id="imagedisplay" style="margin-top: 0px">
        <div>
          <p>Image</p>
          <img id="currentImg" src="" alt="" />
        </div>
        <div
          style="
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
          "
        >
          
          <div>
            <label for="width">Slot:</label>
            <input type="text" name="" id="slot" size="5" value="0x00b8" />
          </div>
          <div>
            <label for="width">Sync Word:</label>
            <input
              type="text"
              name=""
              id="SyncWord"
              size="5"
              value="0x00b800"
            />
          </div>
          <div>
            <label for="width">Msg Size:</label>
            <input type="text" name="" id="MsgSize" size="5" value="0x40" />
          </div>
          <div>
            <label for="width">Screen Order:</label>
            <input type="text" name="" id="ScreenOrder" size="5" value="01" />
          </div>
          <div>
            <label for="width">Multi Slot Rate Mask:</label>
            <input type="text" name="" id="multislotratemask" size="5" value="03" />
          </div>
          <div>
            <input type="checkbox" name="" id="usemultislot" />
            <label for="usemultislot">Use Multi Slot</label>
          </div>
          <div>
            <input type="checkbox" name="" id="isB11" />
            <label for="B==1?">B==1?</label>
          </div>
          <div>
            <input type="checkbox" name="" id="isC11" />
            <label for="C==1?">C==1?</label>
          </div>
          <div>
            <input type="checkbox" name="is color tag" id="colorTag" />
            <label for="colorTag">is color?</label>
          </div>
          <p id="widthHeight"></p>
          <input
            id="btnBmapToBhex"
            type="button"
            value="Convert to ByteHex"
            text="Convert to ByteHex"
            onclick="convertImageToHex()"
          />
          <input
            id="btnBmapToFullscreenDat"
            type="button"
            value="Bitmap to Full Screen DAT"
            text="Convert to ByteHex"
            onclick="bitmapToFullScreenDat()"
          />
        </div>
        <div>
          <p>Hex String</p>
          <textarea name="" id="hexOutput" cols="60" rows="10"></textarea>
        </div>
      </div>
    </div>
    <br />

    <div>
      <h1>ByteHex To BitMap</h1>

      <div
        id="textareaetc"
        style="background-color: rgb(188, 188, 188); margin: 5px"
      >
        <div style="
        margin-left: 10px;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
      ">
          <p>Paste Hex String Below</p>
          <textarea name="" id="hexInput" cols="60" rows="10"></textarea>
          <input
            type="button"
            value="Show CRC"
            text="Convert To Bitmap"
            onclick="crc()"
          />
        </div>
        <div
          id="widthInput"
          style="
            margin-left: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
          "
        >
          <div>
            <label for="width">Width:</label>
            <input type="text" name="" id="width" size="5" />
          </div>
          <div>
            <label for="height">Height:</label>
            <input type="text" name="" id="height" size="5" />
          </div>
          <br />
          <div>
            <input type="checkbox" name="" id="isColor2" />
            <label for="isColor2">is color?</label>
          </div>
          <div>
            <input type="checkbox" name="" id="isB1" />
            <label for="B==1?">B==1?</label>
          </div>
          <div>
            <input type="checkbox" name="" id="isC1" />
            <label for="C==1?">C==1?</label>
          </div>
          <br />
          <input
            type="button"
            value="Convert to Bitmap"
            text="Convert To Bitmap"
            onclick="convertToBitmap()"
          />
        </div>
        <div style="background-color: antiquewhite; margin: 10px">
          <p>Bitmap</p>
          <canvas id="bitmapCanvas" style="margin: 10px"></canvas>
        </div>
      </div>
    </div>
  </body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>
  var image = document.getElementById("currentImg");
  var hexOutput = document.getElementById("hexOutput");
  console.log(image);
  function displaySelectedImage(input) {
    // Check if any file is selected
    if (input.files && input.files[0]) {
      var reader = new FileReader();

      reader.onload = function (e) {
        // Set the src attribute of the image element to the selected image
        document.getElementById("currentImg").src = e.target.result;
      };

      // Read the selected file as a data URL
      reader.readAsDataURL(input.files[0]);
    }
  }
  function convertImageToHex() {
    // Create a canvas element.
    const canvas = document.createElement("canvas");
    // Set the canvas size to the image size.
    const widthHeight = document.getElementById("widthHeight");
    $("#widthHeight").text(
      "Width = " + image.width + " Height = " + image.height
    );
    canvas.width = image.width;
    canvas.height = image.height;

    // Get the canvas context.
    const ctx = canvas.getContext("2d");

    // Draw the image on the canvas.
    ctx.drawImage(image, 0, 0);

    // Get the image data.
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    // Convert the image data to hex.
    const hexData = [];
    const binData = [];
    for (let i = 0; i < imageData.data.length; i += 4) {
      const r = imageData.data[i];
      const g = imageData.data[i + 1];
      const b = imageData.data[i + 2];
      const a = imageData.data[i + 3];
      if (r == 0 && g == 0 && b == 0 && a == 0xff) {
        if ($("#isB11").prop("checked")) {
          binData.push(1);
        } else {
          binData.push(0);
        }
      } else {
        if ($("#isB11").prop("checked")) {
          binData.push(0);
        } else {
          binData.push(1);
        }
      }
    }

    if ($("#colorTag").prop("checked")) {
      for (let i = 0; i < imageData.data.length; i += 4) {
        const r = imageData.data[i];
        const g = imageData.data[i + 1];
        const b = imageData.data[i + 2];
        const a = imageData.data[i + 3];
        if (r == 255 && g == 0 && b == 0 && a == 0xff) {
          if ($("#isC11").prop("checked")) {
            binData.push(1);
          } else {
            binData.push(0);
          }
        } else {
          if ($("#isC11").prop("checked")) {
            binData.push(0);
          } else {
            binData.push(1);
          }
        }
      }
    }

    var bin = binData.join("");
    hexOutput.value = binStrToHexStr(bin);
  }

  function binStrToHexStr(binaryString) {
    // Make sure the binary string length is a multiple of 4
    while (binaryString.length % 4 !== 0) {
      binaryString = "0" + binaryString;
    }

    var hexString = "";
    // Iterate through the binary string, processing 4 bits at a time
    for (var i = 0; i < binaryString.length; i += 4) {
      // Get the current 4-bit substring
      var nibble = binaryString.substr(i, 4);
      // Convert the nibble to its hexadecimal representation
      var hexDigit = parseInt(nibble, 2).toString(16);
      // Append the hexadecimal digit to the result string
      hexString += hexDigit;
    }

    return hexString.toUpperCase();
  }
  var binaryNumber = "1111";
  var hexadecimalNumber = binStrToHexStr(binaryNumber);
  console.log(hexadecimalNumber);

  function convertToBitmap() {
    if (!$("#hexInput").val()) {
      alert("Please enter Hex Strings");
      return;
    }
    if (!$("#width").val()) {
      alert("Please enter Width");
      return;
    }
    if (!$("#height").val()) {
      alert("Please enter Height");
      return;
    }
    var hexstr = $("#hexInput").val();
    var width = $("#width").val();
    var height = $("#height").val();
    var noOfPixels = width * height;
    if ($("#isColor2").prop("checked")) {
      var noOfHexRequired = (noOfPixels / 4) * 2;
    } else {
      var noOfHexRequired = noOfPixels / 4;
    }
    if (hexstr.length !== noOfHexRequired) {
      alert("Please Enter " + noOfHexRequired + " Hex Strings");
      return;
    }

    const canvas = document.getElementById("bitmapCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = $("#width").val();
    canvas.height = $("#height").val();

    var pixLen = canvas.width * canvas.height;
    var binstr = hexStrToBinary(hexstr);

    if ($("#isColor2").prop("checked")) {
      for (let i = 0; i < pixLen; i++) {
        const x = i % width;
        const y = Math.floor(i / width);
        var color = "";
        if (binstr[i] === "1") {
          if ($("#isB1").prop("checked")) {
            color = "black";
          } else {
            color = "white";
          }
        }
        if (binstr[i] === "0") {
          if ($("#isB1").prop("checked")) {
            color = "white";
          } else {
            color = "black";
          }
        }
        // const color = binstr[i] === "1" ? "white" : "black";
        ctx.fillStyle = color;
        ctx.fillRect(x, y, 1, 1);
      }
      for (let i = 0; i < pixLen; i++) {
        const x = i % width;
        const y = Math.floor(i / width);
        var color = "";
        if (binstr[i + pixLen] == "0" && !$("#isC1").prop("checked")) {
          color = "red";
          ctx.fillStyle = color;
          ctx.fillRect(x, y, 1, 1);
        }
        if (binstr[i + pixLen] == "1" && $("#isC1").prop("checked")) {
          color = "red";
          ctx.fillStyle = color;
          ctx.fillRect(x, y, 1, 1);
        }
      }
    } else {
      for (let i = 0; i < pixLen; i++) {
        const x = i % width;
        const y = Math.floor(i / width);
        var color = "";
        color = binstr[i] === "1" ? "white" : "black";
        if ($("#isB1").prop("checked")) {
          var color = binstr[i] === "1" ? "black" : "white";
        }
        ctx.fillStyle = color;
        ctx.fillRect(x, y, 1, 1);
      }
    }
  }
  //00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFFFFF00000000000000000000000002000001000F0000000000000000000002000001000FF0000000000000000000020004090003FF8000000000000000000200070900001FE60000000000000000020004890000006700000000000000000200046900000007000000000000000002204439000000000000000000000000026840090000000000000000000000000220E0010000000000000000000000000230C3F1000600000000000000000000021F861100060000000000000000000002000409000604000000000000000000020004090006060300000000000000000223840900060603000000000000000002244219000606030000000000000000022443F10006060300000000000000000224400100060603000007FFF8000000023C40010007860300003FFFFF000000020000010007FE030000FFFFFFC00000020000010000FFE30003FC000FF0000002004001000007FF0007C00000F80000020003990000003F00078000007800000200046100000001000F0000003C00000213844100010000000E0000001C0000022C444100038000000E0000001C0000022447F900070000000E0000001C0000022440010006000C000E0000003C00000210C40900060006000700000038000002000489000600060007C00000F8000002000489000600030003F80007F0000002004489000600030001FFFFFFE00000020047F90003000300007FFFFF800000023FC0010003800300000FFFFC000000021040010001C0070000000000000000021043810000F00700000000000000000200044100007F3E00000000000000000200044100001FFC000000000000000002000441000007F8000007FFF8000000020007F90000000000003FFFFF00000002000001000000000000FFFFFFC0000002000001000000000003FC000FF00000020000010007C0000007C00000F8000003FFFFFF0007FE000007800000780000000000000000FFF0000F0000003C000000000000000007FF000E0000001C0000000000000000003F000E0000001C00000000000000000001000E0000001C00000000000000000000000E0000003C000000000000000000000007000000380000000000000003F0000007C00000F80000000000000003F8030003F80007F000000000000000073C7F0001FFFFFFE000000000000000060DFF00007FFFFF800007F8000000000607F000000FFFFC000007F8000000000607000000000000000007F8000000000606000000000000000007F8000000000606000000000000000007F80000000007C6000000000000000007F80000000007FE000000000000000007F80000000000FFF00000000000000007F8000000000007FF0007FFFFFFFFFFFFFFFFFC000000003F0007FFFFFFFFFFFFFFFFFC00000000010007FFFFFFFFFFFFFFFFFC00000000000007FFFFFFFFFFFFFFFFFC000001F0000007FFFFFFFFFFFFFFFFFC000003FC000007FFFFFFFFFFFFFFFFFC000003FE000003FFFFFFFFFFFFFFFFFC00000707000000FFF000000007F80000000006030000003FF800000007F80000000006018000000FFE00000007F800000000060180000007FF80000007F800000000060180000001FFE0000007F8000000000601800000007FF8000007F80000000007C1800000001FFE000007F80000000007FF8000000007FF000007F80000000000FFF000000003FFC00007F8000000000007FF00000000FFF00007F80000000000003F000000003FFC0007F800000000000001000000000FFF0007F8000000000000000000000007FF8007F8000000000000000000000001FFE007F80000000000000000000000007FF807F80000000000000000000000001FFE07F800000000000000000000000007FF87F800000000000000000000000003FFC7F800000000000000000000000000FFF7F8000000000000000000000000003FFFF8000000000000000000000000000FFFF80000000001E04000000000000007FFF80000000003F9F800000000000001FFF800000000073BFC000000000000007FF800000000060F0E000000000000001FF8000000000606060000000000000007F80000000006060300000000000000000000000000060603000000003FC00000000000000006060300003C007FF00000000000000007860300007C01FFFC0000000000000007FE030000FC01F07E0000000000000000FFE30001E003E01E000000000000000007FF0001C003C00F0000000000000000003F0003800780070000000000000000000100038007800700000000000000000000000FFFFFFFFFF00000000000000700000003800F00070000000000000007F8000003800F00070000000000000001FFC00003C01F000F00000000000000000FF00001E03E001E0000000000000000007C0001F87E003E0000000000000000001C0000FFFC03FC0000000000000000000600007FF803F80000000000000000000600000FE003E0000000000000000000030000000002000000000000000000000300000000000000000000000000000003000300000000000000000000000000030003F0000000000000000000000780030003FF0000000000000000000007FE0700003FF000000000000000000000FFFE000003FF0000000000000000000007FC0000003FF0000000000000000000003000000003FF8000000000000000000000000000003FF8000000000000000000000000000003FF0000000000000000000000000000003F0000000000000000000000000000000300000000000000000003000000000000000000000000000000030000000000000000000000000000000300000FE000070000000000000000000300003FFC00070000000000000007C0030000FFFE00070000000000000007FE030001F83F80070000000000000000FFF30001E00FC007000000000000000007FF0003C003E0070000000000000000003F00038001F0070000000000000000000100038000FC0700000000000000010000000380007E0700000000000000038000000380001F0700000000000000070000000380000F870000000000000006000C0001C00007C7000000000000000600060001E00003E7000000000000000600060000F00001FF000000000000000600030000FF0000FF0000000000000006000300003F00007F0000000000000003000300000F00001F000000000000000380030000000000070000000000000001C0070000000000000000000000000000F00700000000000000000000000000007F3E00000000000000000000000000001FFC000000000000000000000000000007F800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDC3FFFFFFFFFFFFFFFFFFFFFFFFFFFFF9C1FFFFFFFFFFFFFFFFFFFFFFFFFFFFF388FFFFFFFFFFFFFFFFFFFFFFFFFFFFF39CFFFFFFFFFFFFFFFFFFFFFFFFFFFFF39CFFFFFFFFFFFFFFFFFFFFFFFFFFFFF31CFFFFFFFFFFFFFFFFFFFFFFFFFFFFF33CFFFFFFFFFFFFFFFFFFFFFFFFFFFFF839FFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00FFFFFFFFFFFFFFFFFFFFFFFFFFFFF800FFFFFFFFFFFFFFFFFFFFFFFFFFFFF1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF3FFFFFFFFFFFFFFFFFFFFFFFFE7F9FFF3FFFFFFFFFFFFFFFFFFFFFFFFE7F9FFF3FFFFFFFFFFFFFFFFFFE2FFFE0001FFF9FFFFFFFFFFFFFFFFFFDB7FFF0003FFF000FFFFFFFFFFFFFFFFDB7FFFE7FFFFF000FFFFFFFFFFFFFFFFDB7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFE0FFFFFB87FFFFFFFFFFFFFFFFFFFFFFFFFFFFF383FFFFFEFFFFFFFFFFFFFFFFFFFFFFE711FFFC00FFFFFFFFFFFFFFFFEEFFFFE739FFF801FFFFFFFFFFFFFFFFDF7FFFE739FFF339FFFFFFFFFFFFFFFFDF7FFFE639FFF33CFFFFFFFFFFFFFFFFDF7FFFE679FFF39CFFFFFFFFFFFFFFFFE0FFFFF073FFF39CFFFFFFFFFFFFFFFFFFFFFFF8F7FFF39CFFFFFFFFFFFFFFFFFFFFFFFFFFFFF880FFFFFFFFFFFFFFFEC07FFFFFFFFFFCE3FFFFFFFFFFFFFFFFFFFFFFFC6FFFFFFFFFFFFFFFFFFFFFFFDFFFFFF063FFFFFFFFFFFFFFFFFFFFFFEFFFFFF273FFFE37FFFFFFFFFFFFFFFFC07FFFE679FFF831FFFFFFFFFFFFFFFFFFFFFFE679FFF939FFFFFFFFFFFFFFFFFFFFFFE679FFF33CFFFFFFFFFFFFFFFF0FFFFFE671FFF33CFFFFFFFFFFFFFFFEF7FFFFF263FFF33CFFFFFFFFFFFFFFFEF7FFFFF007FFF338FFFFFFFFFFFFFFFEF7FFFFFC0FFFF931FFFFFFFFFFFFFFFEF7FFFFFFFFFFF803FFFFFFFFFFFFFFFEF7FFFFFFFFFFFE07FFFFFFFFFFFFFFFE007FFFFF87FFFFFFFFFFFFFFFFFFFFFFFFFFFF8703FFFFFFFFFFFFFFFFFFFFFFFFFFFF0073FFFFC3FFFFFFFFFFFFFFFFFFFFFE38F9FFC381FFFFFFFFFFFFFFFFFFFFFE7CF9FF8039FFFFFFFFFFFFFFFFFFFFFE7CF9FF1C7CFFFFFFFFFFFFFFFFDFFFFE7CF9FF3E7CFFFFFFFFFFFFFFFFEFFFFE7CF9FF3E7CFFFFFFFFFFFC01FFC07FFE7CF9FF3E7CFFFFFFFFFFF0007FFFFFFE7CF9FF3E7CFFFFFFFFFFE0003FFFFFFE0001FF3E7CFFFFFFFFFFC38E3FE2FFFE0001FF3E7CFFFFFFFFFFC7C71FDB7FFFFFFFFF0000FFFFFFFFFFC7C71FDB7FFFFFFFFF0000FFFFFFFFFFC7C71FDB7FFFFFFFFFFFFFFFFFFFFFFFC3861FE0FFFFFFFFFFFFFFFFFFFFFFFFE00C3FFFFFFFFFFFFFFFFFFFFFFFFFFFF00C3FFFFFFFFFFFFFFFFFFFFFFFFFFFF83CFFE0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDF7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFDF7FFFFFFFFFFFFFFFFFFFFFFFFFF8FFEF7FFFFB87FFFFFFFFFFFFFFFFFFF8FE007FFFF383FFFFFFFFFFFFFFFFC0001FFFFFFFE711FF0000FFFFFFFFFFC0001FFFFFFFE739FF0000FFFFFFFFFFC0001FE07FFFE739FFF9F9FFFFFFFFFFE1F8FFDFFFFFE639FFF3FCFFFFFFFFFFF878FFDFFFFFE679FFF3FCFFFFFFFFFFFC18FFEFFFFFF073FFF3FCFFFFFFFFFFFF08FFE07FFFF8F7FFF3FCFFFFFFFFFFFF80FFDFFFFFFFFFFFF9F9FFFFFFFFFFFFE0FFDFFFFFFFFFFFF801FFFFFFFFFFFFF0FFEFFFFE07FFFFFE03FFFFFFFFFFFFFFFFC07FFE07FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1FFFFFFFFFFFFFFE37FFFFFFFFFFFFFF1FE2FFFFF801FFF831FFF8FE7FFFFFFF1FDB7FFFF001FFF939FFF87E7FFFFFFFFFDB7FFFE3FFFFF33CFFF83E7FFFFFFFFFDB7FFFE7FFFFF33CFFF91E7FFFF87F1FE0FFFFE7FFFFF33CFFF98E7FFFE01F1FFFFFFFE7FFFFF338FFF9C67FFFE00F1FFFFFFFF3FFFFF931FFF9E27FFFC3871E007FFE0001FFF803FFF9F07FFFC7C31F3FFFFE0001FFFE07FFF9F87FFFC7E11FCFFFFFFFFFFFFFFFFFFFFC7FFFC7F01FF1FFFFFFFFFFF7FEFFFFFFFFFFC3F81FFE7FFFFB87FFF3F8FFFF03FFFFE1FC1FF1FFFFF383FFF1E0FFFE01FFFFE1FE1FCFFFFFE711FFF883FFFC78FFFFF9FF9F3FFFFFE739FFFC0FFFF8FC7FFFFFFFFE007FFFE739FFFE3FFFF9FE7FFFFFFFFFFFFFFFE639FFFF1FFFF9FE7FFFFFFFFFFFFFFFE679FF0000FFF9FE7FFFFFFFFFFBFFFFF073FF0000FFF8FC7FFFFFFFFFFBFFFFF8F7FFFFFFFFFC78FFFFFFFFFFFBFFFFFFFFFFFFFFFFFE01FFFFFFFFFFFFFFFFFFFFFFFFFEFFFF03FFFFFFFFFFE07FFFE001FFFC00FFFFFFFFFFFFFFFFDFFFFFE001FFF801FFFFFFFFFFFFFFFFDFFFFFFFF3FFF339FFE783FFFFFFFFFFEFFFFFFFF9FFF33CFFC700FFFFFFFFFFC07FFFFFF9FFF39CFF8E3CFFFFFFFFFFFFFFFFFFF9FFF39CFF9E7E7FFFFFFFFFFFFFFFFFF1FFF39CFF9E7E7FFFFFFFFFE0FFFFE003FFF880FF9E7E7FFFFFFFFFDF7FFFE007FFFCE3FF9F7E7FFFFFFFFFDF7FFFFFFFFFFFFFFFC73CFFFFFFFFFFDF7FFFFFFFFFFFFFFFE000FFFFFFFFFFE0FFFFFF87FFFFC3FFF803FFFFFFFFFFFFFFFF8703FFC381FFFFFFFFFFFFFFFFFFFFFF0073FF8039FFFFFFFFFFFFFFFE007FFE38F9FF1C7CFFFFFFFFFFFFFFFFFEFFFE7CF9FF3E7CFFFFFFFFFFFFFFFFF9FFFE7CF9FF3E7CFFFFFFFFFFFFFFFFE7FFFE7CF9FF3E7CFF80007FFFFFFFFF9FFFFE7CF9FF3E7CFF80007FFFFFFFFF7FFFFE7CF9FF3E7CFFE7FFFFFFFFFFFE007FFE7CF9FF3E7CFFF3FFFFFFFFFFFFFFFFFE0001FF0000FFF3FFFFFFFFFFFFFFFFFE0001FF0000FFF9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  function hexStrToBinary(hexStr) {
    let binaryStr = "";
    for (let i = 0; i < hexStr.length; i++) {
      const bin = parseInt(hexStr[i], 16).toString(2).padStart(4, "0");
      binaryStr += bin;
    }
    return binaryStr;
  }
  function bitmapToFullScreenDat() {
    // Create a canvas element.
    const canvas = document.createElement("canvas");
    // Set the canvas size to the image size.
    const widthHeight = document.getElementById("widthHeight");
    $("#widthHeight").text(
      "Width = " + image.width + " Height = " + image.height
    );
    canvas.width = image.width;
    canvas.height = image.height;

    // Get the canvas context.
    const ctx = canvas.getContext("2d");

    // Draw the image on the canvas.
    ctx.drawImage(image, 0, 0);

    // Get the image data.
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    // Convert the image data to hex.
    const hexData = [];
    const binData = [];
    for (let i = 0; i < imageData.data.length; i += 4) {
      const r = imageData.data[i];
      const g = imageData.data[i + 1];
      const b = imageData.data[i + 2];
      const a = imageData.data[i + 3];
      if (r == 0 && g == 0 && b == 0 && a == 0xff) {
        if ($("#isB11").prop("checked")) {
          binData.push(1);
        } else {
          binData.push(0);
        }
      } else {
        if ($("#isB11").prop("checked")) {
          binData.push(0);
        } else {
          binData.push(1);
        }
      }
    }

    if ($("#colorTag").prop("checked")) {
      for (let i = 0; i < imageData.data.length; i += 4) {
        const r = imageData.data[i];
        const g = imageData.data[i + 1];
        const b = imageData.data[i + 2];
        const a = imageData.data[i + 3];
        if (r == 255 && g == 0 && b == 0 && a == 0xff) {
          if ($("#isC11").prop("checked")) {
            binData.push(1);
          } else {
            binData.push(0);
          }
        } else {
          if ($("#isC11").prop("checked")) {
            binData.push(0);
          } else {
            binData.push(1);
          }
        }
      }
    }

    var bin = binData.join("");
    var bytesHexStr = binStrToHexStr(bin);

    if (bytesHexStr.length > 1024 * 12 * 2) {
      covertHex2CmdsForLarge(bytesHexStr);
    } else {
      covertHex2Cmds(bytesHexStr);
    }
  }

  function covertHex2CmdsForLarge(bytesHexStr) {}
  function covertHex2Cmds(bytesHexStr) {
    let txt = "";
    let slotInt = parseInt($("#slot").val(), 16);
    let slot = "0x" + slotInt.toString(16).padStart(4, "0").toUpperCase();

    let msgSize = parseInt($("#MsgSize").val(), 16);
    let scrnOrdinal = $("#ScreenOrder").val();
    let scrnSizeInt = Math.floor(bytesHexStr.length / 2);
    let scrnSize = scrnSizeInt.toString(16).padStart(4, "0");
    let noOfBlocks = Math.ceil(scrnSizeInt / msgSize)
      .toString(16)
      .padStart(4, "0");
    let blockSize = $("#MsgSize")
      .val()
      .trim()
      .replace("0x", "")
      .padStart(2, "0");
    let crc = crc16Ccitt(bytesHexStr).toString(16).padStart(8, "0");
    let syncWord = $("#SyncWord").val().trim();

    //Start of Transfer
    txt =
      txt +
      "writeScr," +
      slot +
      "," +
      syncWord +
      ",00" +
      (scrnOrdinal + scrnSize + blockSize + noOfBlocks + crc).toUpperCase() +
      "\r\n";
    let bmpStrs = splitByLength(bytesHexStr, msgSize * 2);
    //uint startAddr = Convert.ToUInt32(textBoxScreenOrdinal.Text.Trim().PadLeft(8, '0'), 16);

    let shortSlot = 0;
    shortSlot = parseInt(slot, 16);

    let blockNo = 0;
    for (let i = 0; i < bmpStrs.length; i++) {
      slot = "0x" + shortSlot.toString(16).padStart(4, "0");
      let str = bmpStrs[i];
      txt =
        txt +
        "writeScr," +
        slot +
        "," +
        syncWord +
        ",01" +
        (
          scrnOrdinal +
          blockNo.toString(16).padStart(4, "0") +
          str
        ).toUpperCase() +
        "\r\n";
      blockNo = blockNo + 1;
      shortSlot = this.getNextSlot(shortSlot);
    }
    //Render the screen
    txt =
      txt +
      "writeScr," +
      slot +
      "," +
      syncWord +
      ",03" +
      (scrnOrdinal + "02").toUpperCase() +
      "\r\n";

    $("#hexOutput").val(txt);
  }
  function crc16Ccitt(strInput) {
    let bytes = stringToByteArrayFastest(strInput);
    let poly = 4129;
    let table = new Array(256).fill(0);
    let initialValue = 0xffff;
    let temp, a;
    let crc = initialValue;
    for (let i = 0; i < table.length; ++i) {
      temp = 0;
      a = i << 8;
      for (let j = 0; j < 8; ++j) {
        if (((temp ^ a) & 0x8000) != 0) temp = (temp << 1) ^ poly;
        else temp <<= 1;
        a <<= 1;
      }
      table[i] = temp;
    }
    for (let i = 0; i < bytes.length; ++i) {
      crc = ((crc << 8) ^ table[(crc >> 8) ^ (0xff & bytes[i])]) & 0xffff;
    }
    return crc;
  }

  function stringToByteArrayFastest(hex) {
    if (hex.length % 2 == 1)
      throw new Error("The binary key cannot have an odd number of digits");

    let arr = new Array(hex.length >> 1).fill(0);

    for (let i = 0; i < hex.length >> 1; ++i) {
      arr[i] =
        ((getHexVal(hex.charAt(i << 1)) << 4) +
          getHexVal(hex.charAt((i << 1) + 1))) &
        0xff;
    }

    return arr;
  }

  function getHexVal(hex) {
    let val = hex.charCodeAt(0);
    val = val - (val < 58 ? 48 : val < 97 ? 55 : 87);
    return val;
  }

  function splitByLength(str, length) {
    let a = new Array();
    for (let i = 0; i < str.length; i += length) {
      if (i + length < str.length) {
        a.push(str.substr(i, length));
      } else {
        let subStr = str.substr(i);
        a.push(subStr);
      }
    }

    return a;
  }

  function getNextSlot(shortSlot) {
    if (!$("#usemultislot").prop("checked")) {
      return shortSlot;
    }

    let foundSlot = false;
    let slotWakeUpCount = Math.pow(
      2,
      parseInt($("#multislotratemask").val().trim(), 16) + 1
    );

    while (!foundSlot) {
      shortSlot = shortSlot + slotWakeUpCount;
      if (shortSlot > 2047) {
        shortSlot = shortSlot - 2048;
      }
      let list = [0, 1, 2, 3, 63, 64, 65, 66, 67, 200, 2047];
      let exists = list.includes(shortSlot);
      if (!exists) {
        foundSlot = true;
      }
    }

    return shortSlot;
  }

  function crc(){
    let hexstr=$("#hexInput").val();
    let crc = crc16Ccitt(hexstr).toString(16);
    alert("CRC "+crc);
  }
</script>
